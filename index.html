<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tiny Local AI Chat – SmolLM2 360M</title>
  <script src="https://cdn.jsdelivr.net/npm/@mlc-ai/web-llm@0.2.48/dist/web-llm.js"></script>
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      padding: 20px;
      background: #0f0f17;
      color: #e0e0ff;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    h1 { text-align: center; color: #a78bfa; margin-bottom: 8px; font-size: 1.5rem; }
    #chat {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      background: #1e1e2e;
      border-radius: 12px;
      margin-bottom: 12px;
      border: 1px solid #4c1d95;
    }
    .msg {
      margin: 10px 0;
      padding: 12px 16px;
      border-radius: 16px;
      max-width: 85%;
    }
    .user { background: #7c3aed; color: white; margin-left: auto; }
    .assistant { background: #312e81; color: #e0e0ff; }
    form {
      display: flex;
      gap: 10px;
    }
    input {
      flex: 1;
      padding: 14px;
      border-radius: 12px;
      border: none;
      background: #312e81;
      color: white;
      font-size: 1rem;
    }
    button {
      padding: 14px 24px;
      background: #a78bfa;
      color: black;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: bold;
    }
    #status {
      text-align: center;
      color: #94a3b8;
      margin: 12px 0;
      font-size: 0.95em;
    }
    #input, button { opacity: 0.5; pointer-events: none; }
  </style>
</head>
<body>

<h1>Tiny Local AI (SmolLM2-360M)</h1>
<p>Very small (~300 MB) • First load downloads model • Then unlimited & offline</p>

<div id="chat">
  <div class="msg assistant">Initializing engine... Please wait (one-time download ~300 MB).</div>
</div>

<div id="status">Starting download & setup...</div>

<form id="form">
  <input id="input" placeholder="Ask anything..." disabled />
  <button type="submit" disabled>Send</button>
</form>

<script type="module">
  import { CreateMLCEngine } from "@mlc-ai/web-llm";

  const chatDiv = document.getElementById('chat');
  const status = document.getElementById('status');
  const form = document.getElementById('form');
  const input = document.getElementById('input');
  const sendBtn = form.querySelector('button');

  let engine;

  async function init() {
    try {
      status.textContent = 'Downloading tiny model (~300 MB) – one-time only...';
      
      engine = await CreateMLCEngine(
        "SmolLM2-360M-Instruct-q4f16_1-MLC",  // smallest efficient model
        {
          initProgressCallback: (report) => {
            status.textContent = report.text;  // shows "Fetching... 45%", "Decompressing...", etc.
          }
        }
      );

      status.textContent = 'Ready! Model loaded – ask anything.';
      input.disabled = false;
      sendBtn.disabled = false;
      input.focus();
    } catch (err) {
      status.textContent = `Error: ${err.message}`;
      console.error('WebLLM init failed:', err);
    }
  }

  init();

  form.addEventListener('submit', async e => {
    e.preventDefault();
    const text = input.value.trim();
    if (!text || !engine) return;

    const userMsg = document.createElement('div');
    userMsg.className = 'msg user';
    userMsg.textContent = text;
    chatDiv.appendChild(userMsg);
    chatDiv.scrollTop = chatDiv.scrollHeight;

    input.value = '';
    status.textContent = 'Generating...';

    try {
      const reply = await engine.chat.completions.create({
        messages: [{ role: "user", content: text }],
        temperature: 0.7,
        max_tokens: 256   // keep short for tiny model
      });

      const assistantMsg = document.createElement('div');
      assistantMsg.className = 'msg assistant';
      assistantMsg.textContent = reply.choices[0].message.content.trim();
      chatDiv.appendChild(assistantMsg);
      chatDiv.scrollTop = chatDiv.scrollHeight;

      status.textContent = '';
    } catch (err) {
      status.textContent = `Error: ${err.message}`;
      console.error(err);
    }
  });
</script>

</body>
</html>
